<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prenotazione Libri - Classi Quinte</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .user-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
        }

        .user-input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .user-input-group label {
            font-weight: bold;
            font-size: 1.1em;
        }

        .user-input-group input {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1em;
            min-width: 200px;
        }

        .user-input-group button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-input-group button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .current-user {
            margin-top: 15px;
            text-align: center;
            font-size: 1.1em;
        }

        .current-user strong {
            color: #667eea;
        }

        .books-section {
            padding: 30px;
        }

        .filters {
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filters input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
        }

        .filters select {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .book-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            background: white;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .book-card.reserved {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .book-card.my-reservation {
            border-color: #51cf66;
            background: #f0fff4;
        }

        .book-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .book-author {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .book-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .book-status.available {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .book-status.reserved {
            background: #ffebee;
            color: #c62828;
        }

        .book-actions {
            display: flex;
            gap: 10px;
        }

        .book-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-reserve {
            background: #51cf66;
            color: white;
        }

        .btn-reserve:hover {
            background: #40c057;
        }

        .btn-cancel {
            background: #ff6b6b;
            color: white;
        }

        .btn-cancel:hover {
            background: #ff5252;
        }

        .btn-reserve:disabled,
        .btn-cancel:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .share-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: center;
        }

        .btn-whatsapp {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 30px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-whatsapp:hover {
            background: #128C7E;
            transform: scale(1.05);
        }

        .no-books {
            text-align: center;
            padding: 50px;
            color: #999;
            font-size: 1.2em;
        }

        .reserved-by {
            color: #c62828;
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .book-grid {
                grid-template-columns: 1fr;
            }

            .user-input-group {
                flex-direction: column;
            }

            .user-input-group input,
            .user-input-group button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Prenotazione Libri</h1>
            <p>Scuola Primaria Asfodelo - Classi Quinte A.S. 2025-2026</p>
        </div>

        <div class="user-section">
            <div class="user-input-group">
                <label for="userId">Il tuo ID Genitore:</label>
                <input type="text" id="userId" placeholder="Es: Genitore1, G123, etc." />
                <button onclick="setUser()">Imposta ID</button>
            </div>
            <div class="current-user" id="currentUserDisplay"></div>
        </div>

        <div class="books-section">
            <div class="stats">
                <div class="stat-card">
                    <h3 id="totalBooks">0</h3>
                    <p>Libri Totali</p>
                </div>
                <div class="stat-card">
                    <h3 id="availableBooks">0</h3>
                    <p>Disponibili</p>
                </div>
                <div class="stat-card">
                    <h3 id="myReservations">0</h3>
                    <p>Le Mie Prenotazioni</p>
                </div>
            </div>

            <div class="filters">
                <input type="text" id="searchInput" placeholder="üîç Cerca per titolo o autore..." onkeyup="filterBooks()" />
                <select id="filterStatus" onchange="filterBooks()">
                    <option value="all">Tutti i libri</option>
                    <option value="available">Solo disponibili</option>
                    <option value="reserved">Solo prenotati</option>
                    <option value="myReservations">Le mie prenotazioni</option>
                </select>
            </div>

            <div class="book-grid" id="bookGrid"></div>
        </div>

        <div class="share-section">
            <h3 style="margin-bottom: 15px;">Condividi le tue scelte</h3>
            <button class="btn-whatsapp" onclick="shareOnWhatsApp()">
                <span style="font-size: 1.5em;">üì±</span>
                Condividi su WhatsApp
            </button>
        </div>
    </div>

    <script>
        const books = [
            { title: "La ninfa di porcellana", author: "Allende" },
            { title: "Anna, la bambina del mare", author: "Almond" },
            { title: "Un mistero per gatto Cagliostro", author: "Altieri" },
            { title: "La mia scuola segreta in Afghanistan", author: "Alvisi" },
            { title: "Storie da paura", author: "Antonini" },
            { title: "Io conto", author: "Anna Cerasoli" },
            { title: "Sono il numero 1", author: "Anna Cerasoli" },
            { title: "Fairy Oak - La trilogia", author: "Elisabetta Gnone" },
            { title: "L'orologiaio che torn√≤ bambino", author: "Yvonne Campedel" },
            { title: "L'Albero di Molto Lontano", author: "Enid Blyton" },
            { title: "GreenWood La strega Urania", author: "Barbara Canepa, Ana√Øs Halard" },
            { title: "Il primo gatto nello spazio mangia la pizza!", author: "Mac Barnett" },
            { title: "Voglio fare lo strego", author: "Giuseppe d'Anna" },
            { title: "Lo chiamavano formica", author: "Dita Zipfel" },
            { title: "Proibito leggere!", author: "Alan Gratz" },
            { title: "La verit√† sul caso Hansel e Gretel", author: "Alessandro Barbaglia" },
            { title: "Ubaldo Quattrocchi, maestro per sbaglio", author: "Giuseppe D'Anna" },
            { title: "Magari!", author: "Bruno Tognolini" },
            { title: "L'et√† di mezzo", author: "Emanuela Nava" },
            { title: "New Girl", author: "Cassandra Calin" },
            { title: "Datemi un po' di... spazio", author: "Philip Bunting" },
            { title: "L'enigma della torre", author: "Anna Lavatelli" },
            { title: "Nuno di niente", author: "Roberto Morgese" },
            { title: "Le parole fanno il solletico", author: "Daniel Pennac, Stefano Bartezzaghi" },
            { title: "Il libro degli errori", author: "Gianni Rodari" },
            { title: "Scolpitelo nel vostro cuore", author: "Liliana Segre" },
            { title: "L'isola del tempo perso", author: "Silvana Gandolfi" },
            { title: "Il venditore di felicit√†", author: "Davide Cal√¨" },
            { title: "La nuova amica", author: "Charlotte Zolotow" },
            { title: "Il pacchetto rosso", author: "Linda Wolfsgruber, Gino Alberti" },
            { title: "Enola Holmes - il caso del marchese scomparso", author: "Nancy Springer" },
            { title: "Il club degli strani", author: "Jordi Sierra i Fabra" },
            { title: "Le streghe - La graphic novel", author: "Roald Dahl, P√©n√©lope Bagieu" },
            { title: "Storie di bambini molto antichi", author: "Laura Orvieto, Rita Petruccioli" },
            { title: "La scuola degli animali magici", author: "Margit Auer" },
            { title: "Dieci piccoli gialli 4", author: "Carlo Barbieri" },
            { title: "C'√® un albero in Giappone", author: "Chiara Bazzoli" },
            { title: "Meritre e lo spettro della Valle dei Re", author: "Giorgia Cappelletti" },
            { title: "Una foresta da salvare", author: "Anna Casalis" },
            { title: "Il villaggio dai 13 segreti", author: "Nadine Debertolis" },
            { title: "Cuore di farfalla", author: "Chiara Ottanelli" },
            { title: "Il riscaldamento globale", author: "Sergio Rossi" },
            { title: "L'incredibile Plantoide", author: "Chiara Valentina Segr√©, Barbara Mazzolai" },
            { title: "Le inquietanti storie di Weird Street", author: "Anne Fine" },
            { title: "Elettra", author: "Brian Freschi, Elena Triolo" },
            { title: "L'albero di molto lontano - Scintille di magia", author: "Enid Blyton, Jacqueline Wilson" },
            { title: "La bambina cadavere", author: "Reece Carter" },
            { title: "Mortina - Una storia che ti far√† morire dal ridere", author: "Barbara Cantini" },
            { title: "Mortina e la stanza nascosta", author: "Barbara Cantini" },
            { title: "Harold e la matita viola", author: "Crockett Johnson" },
            { title: "La cabina telefonica di Yuan Huan", author: "Miyase Sertbarut" },
            { title: "Qualcuno mi aspetta dietro la neve", author: "Timoth√©e de Fombelle" },
            { title: "Nonno in fuga", author: "David Walliams" },
            { title: "Jonas e il predatore degli incubi", author: "Francesco Carofiglio" }
        ];

        let currentUser = localStorage.getItem('currentUser') || '';
        let reservations = JSON.parse(localStorage.getItem('bookReservations')) || {};

        function init() {
            if (currentUser) {
                document.getElementById('userId').value = currentUser;
                updateCurrentUserDisplay();
            }
            renderBooks();
            updateStats();
        }

        function setUser() {
            const input = document.getElementById('userId').value.trim();
            if (input === '') {
                alert('Per favore inserisci un ID valido!');
                return;
            }
            currentUser = input;
            localStorage.setItem('currentUser', currentUser);
            updateCurrentUserDisplay();
            renderBooks();
            updateStats();
        }

        function updateCurrentUserDisplay() {
            const display = document.getElementById('currentUserDisplay');
            if (currentUser) {
                display.innerHTML = `Sei connesso come: <strong>${currentUser}</strong>`;
            } else {
                display.innerHTML = '';
            }
        }

        function renderBooks() {
            const grid = document.getElementById('bookGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatus').value;

            let filteredBooks = books.filter(book => {
                const matchesSearch = book.title.toLowerCase().includes(searchTerm) || 
                                    book.author.toLowerCase().includes(searchTerm);
                
                if (!matchesSearch) return false;

                const isReserved = reservations[book.title];
                const isMyReservation = isReserved && reservations[book.title] === currentUser;

                if (filterStatus === 'available') return !isReserved;
                if (filterStatus === 'reserved') return isReserved;
                if (filterStatus === 'myReservations') return isMyReservation;
                
                return true;
            });

            if (filteredBooks.length === 0) {
                grid.innerHTML = '<div class="no-books">Nessun libro trovato</div>';
                return;
            }

            grid.innerHTML = filteredBooks.map(book => {
                const isReserved = reservations[book.title];
                const isMyReservation = isReserved && reservations[book.title] === currentUser;
                const cardClass = isMyReservation ? 'my-reservation' : (isReserved ? 'reserved' : '');

                return `
                    <div class="book-card ${cardClass}">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">di ${book.author}</div>
                        <div class="book-status ${isReserved ? 'reserved' : 'available'}">
                            ${isReserved ? '‚ùå Prenotato' : '‚úÖ Disponibile'}
                        </div>
                        ${isReserved && !isMyReservation ? `<div class="reserved-by">Prenotato da: ${reservations[book.title]}</div>` : ''}
                        ${isMyReservation ? '<div class="reserved-by" style="color: #2e7d32;">‚úì La tua prenotazione</div>' : ''}
                        <div class="book-actions">
                            ${!currentUser ? 
                                '<button disabled>Imposta ID prima</button>' :
                                isMyReservation ?
                                    `<button class="btn-cancel" onclick="cancelReservation('${book.title.replace(/'/g, "\\'")}')">Annulla</button>` :
                                    isReserved ?
                                        '<button disabled>Non disponibile</button>' :
                                        `<button class="btn-reserve" onclick="reserveBook('${book.title.replace(/'/g, "\\'")}')">Prenota</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function reserveBook(title) {
            if (!currentUser) {
                alert('Imposta prima il tuo ID genitore!');
                return;
            }

            if (reservations[title]) {
                alert('Questo libro √® gi√† stato prenotato!');
                return;
            }

            reservations[title] = currentUser;
            localStorage.setItem('bookReservations', JSON.stringify(reservations));
            renderBooks();
            updateStats();
        }

        function cancelReservation(title) {
            if (reservations[title] === currentUser) {
                delete reservations[title];
                localStorage.setItem('bookReservations', JSON.stringify(reservations));
                renderBooks();
                updateStats();
            }
        }

        function filterBooks() {
            renderBooks();
        }

        function updateStats() {
            const total = books.length;
            const reserved = Object.keys(reservations).length;
            const available = total - reserved;
            const myReservations = Object.values(reservations).filter(user => user === currentUser).length;

            document.getElementById('totalBooks').textContent = total;
            document.getElementById('availableBooks').textContent = available;
            document.getElementById('myReservations').textContent = myReservations;
        }

        function shareOnWhatsApp() {
            if (!currentUser) {
                alert('Imposta prima il tuo ID genitore!');
                return;
            }

            const myBooks = Object.entries(reservations)
                .filter(([title, user]) => user === currentUser)
                .map(([title]) => title);

            if (myBooks.length === 0) {
                alert('Non hai ancora prenotato nessun libro!');
                return;
            }

            const message = `üìö *Prenotazioni Libri - Classi Quinte*\n\n` +
                          `ID: ${currentUser}\n\n` +
                          `Libri prenotati (${myBooks.length}):\n` +
                          myBooks.map((book, i) => `${i + 1}. ${book}`).join('\n') +
                          `\n\n_Scuola Primaria Asfodelo A.S. 2025-2026_`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>
